<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Veera Cinemas Lucky Draw</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>

<header>
  <img src="logo.png" alt="Veera Cinemas Logo">
</header>

<!-- Welcome Section -->
<div class="welcome-container" id="welcomeScreen">
  <h1>Welcome to Coolie!</h1>
  <p>ðŸŽ‰ Veera Cinemas celebrates with an exciting Lucky Draw! Join now for a chance to win amazing prizes.</p>

  <div class="welcome-buttons">
    <a href="https://chat.whatsapp.com/FjKFb5hAOuBDs4HEpenxnB?mode=ac_t" target="_blank" class="btn-whatsapp">ðŸ“² Join WhatsApp Group</a>
    <a href="https://instagram.com/veeracinemas" target="_blank" class="btn-insta">ðŸ“¸ Follow on Instagram</a>
  </div>

  <p class="welcome-note">Follow us to participate in the Lucky Draw and grab your chance to win exclusive goodies!</p>
</div>

<!-- Lucky Draw Section (hidden initially) -->
<h3 id="luckyDrawHeading" style="display:none; text-align:center; color:#5e1d7d;">Lucky Draw</h3>
<div id="luckyDrawContent" style="display:none;">
  <!-- Your lucky draw content here -->
  <p style="text-align:center;">Draw in progress...</p>
</div>

<audio id="bgMusic" src="bg.mp3" loop></audio>
<audio id="winnerMusic" src="winner.mp3"></audio>

<!-- Firebase -->
<script type="module" src="firebase-init.js"></script>
<script type="module">
  import { db } from './firebase-init.js';
  import { doc, onSnapshot } from 'https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js';

  const stateDocRef = doc(db, 'state', 'draw');
  const bgMusic = document.getElementById("bgMusic");
  const winnerMusic = document.getElementById("winnerMusic");

  onSnapshot(stateDocRef, (snap) => {
    if (!snap.exists()) return;

    const data = snap.data();
    console.log("Draw State:", data.state);

    if (data.state === "running") {
      startLuckyDraw();
      playBgMusic();
    }
    else if (data.state === "finished") {
      stopBgMusic();
      playWinnerMusic();
    }
    else {
      // Default state - welcome screen
      document.getElementById("welcomeScreen").style.display = "block";
      document.getElementById("luckyDrawHeading").style.display = "none";
      document.getElementById("luckyDrawContent").style.display = "none";
    }
  });

  function startLuckyDraw() {
    document.getElementById("luckyDrawHeading").style.display = "block";
    document.getElementById("luckyDrawContent").style.display = "block";
    document.getElementById("welcomeScreen").style.display = "none";
  }

  function playBgMusic() {
    bgMusic.play().catch(err => console.warn("Autoplay blocked:", err));
  }

  function stopBgMusic() {
    bgMusic.pause();
    bgMusic.currentTime = 0;
  }

  function playWinnerMusic() {
    winnerMusic.play().catch(err => console.warn("Autoplay blocked:", err));
  }
</script>

</body>
</html>
